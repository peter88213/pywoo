<?xml version="1.0" encoding="UTF-8"?>
<project name="pywriter_oo" basedir=".">
	<property name="release" value="0.18.4" />
	<property name="oxt_file" value="SaveYw-1.0.1.oxt" />
	
	<property name="oxt" location="../oxt" />
	<property name="src" location="../src" />
	<property name="test" location="../test" />
	<property name="dist" location="../dist" />
	<property name="reg" location="../reg" />
	<property name="project-name" value="${ant.project.name}" />
	<property name="release-name" value="${project-name}_v${release}" />

	<target name="build" description="inline all library modules">
		
		<delete dir="${dist}" />
		<delete file="${test}/saveyw.pyw" />
		<delete file="${test}/openyw.pyw" />
			<exec executable="python" failonerror="true">
			    <arg value="${src}/build_saveyw_pyw.py"/>
			</exec>
			<exec executable="python" failonerror="true">
			    <arg value="${src}/build_openyw_pyw.py"/>
			</exec>
	</target>

	<target name="dist" description="generate the distribution">
		
		<mkdir dir="${dist}" />
		<mkdir dir="${dist}/PyWriter_OO_v${release}" />
		<mkdir dir="${dist}/PyWriter_OO_v${release}/setup" />
		<mkdir dir="${dist}/PyWriter_OO_v${release}/setup/program" />

		<replace file="${test}/saveyw.pyw" token="@release" value="${release}" />
		<copy file="${test}/saveyw.pyw" todir="${dist}/PyWriter_OO_v${release}/setup/program" />

		<replace file="${test}/openyw.pyw" token="@release" value="${release}" />
		<copy file="${test}/openyw.pyw" todir="${dist}/PyWriter_OO_v${release}/setup/program" />

		<copy file="${oxt}/${oxt_file}" todir="${dist}/PyWriter_OO_v${release}/setup/program" />
		<copy file="${reg}/add_cm.reg" todir="${dist}/PyWriter_OO_v${release}/setup" />
		<copy file="${reg}/del_cm.reg" todir="${dist}/PyWriter_OO_v${release}/setup" />

		<copy file="./Install.bat" todir="${dist}/PyWriter_OO_v${release}" />
		<replace file="${dist}/PyWriter_OO_v${release}/Install.bat" token="@release" value="${release}" />
		<replace file="${dist}/PyWriter_OO_v${release}/Install.bat" token="@oxt_file" value="${oxt_file}" />
		
		<copy file="./Uninstall.bat" todir="${dist}/PyWriter_OO_v${release}" />
		<replace file="${dist}/PyWriter_OO_v${release}/Uninstall.bat" token="@release" value="${release}" />
		<replace file="${dist}/PyWriter_OO_v${release}/Uninstall.bat" token="@oxt_file" value="${oxt_file}" />

		<copy file="../README.md" todir="${dist}/PyWriter_OO_v${release}" />
		<copy file="../LICENSE" todir="${dist}/PyWriter_OO_v${release}" />

		<zip destfile="${dist}/PyWriter_OO_v${release}.zip" basedir="${dist}/PyWriter_OO_v${release}" />

	</target>

	
</project>